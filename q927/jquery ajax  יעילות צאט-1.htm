<!DOCTYPE html>
<html lang="he" itemscope="" itemtype="http://schema.org/Blog" ng-app="phpg">
<head>
<base href="https://phpguide.co.il/">
<meta charset="utf-8">
<meta name="description" content="שאלה jquery ajax - יעילות צאט">
<meta name="keywords" content="שאלה, עזרה">
<meta name="author" content="nirbe">
<link rel="shortcut icon" href="..\static\images\favicon-1.ico">
<!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="..\static\styles\allstyles.compiled.css">
<title>jquery ajax - יעילות צאט | שאלת לימוד PHP</title>
<meta itemprop="name" content="jquery ajax - יעילות צאט | שאלת לימוד PHP">
<meta itemprop="description" content="שאלה jquery ajax - יעילות צאט">
</head>
<body dir='rtl' class="forum-qna">
<div class='page-container'>
<section id='header'>
<div class="topRowHolder">
<a class="logo" href="..\index-3.htm"><img src="..\static\images\logo.jpg"></a>
<nav class="main">
<ul>
<li><a href="..\index-3.htm">פוסטים</a></li>
<li><a href="..\qna-1.htm" class="active">פורום</a></li>
</ul>
<div class="clear"></div>
</nav> <div class="clear"></div>
</div>
</section>  
<div class="layout-holder">
<section id="content">
<div class="qna_view_question" id="qnaQuestionHolder">
<div class="qna-home-row">
<div class="counts">
 
<div class="status  answered">
<div class="item-count">11</div>
<div>
תגובות
</div>
</div>
</div>
<div class="question-summary-wrapper">
<h2><a href="jquery ajax  יעילות צאט-1.htm" title="שלום,כשאני בונה צאט ב jq ajax אני משתמש ב settimeout כדי לרענן את הפונקציה ששולפת בעזרת POST את הדף עם הצגת ההודעות.עכשיו, אני יודע שזה לא יעיל מכוון שאם יש לי המון משתמשים בצאט, ואצל כל אחד הצאט מתרענן כל שנייה, זה יעמיס על השרת.השאלה שלי איך אפשר לעשות שהצאט יתרענן אך ורק אם יש הודעה חדשה? כדי שיעמיס פחות על השרת?תודה רבה!">jquery ajax - יעילות צאט</a></h2>
<div class="userinfo">
פתח
<a>nirbe</a>
,
<time class="timeago relativetime" datetime="2012-08-20T09:51:29+03:00" style="display:inline-block;">
20 לאוגוסט 2012 </time>
</div>
</div>
</div> <div class="clear"></div>
<div style="border-top:1px dashed #D1D1D1; margin-top:10px; padding-top:10px; " class="qnapost" id='questionText927'>
שלום,<br>כשאני בונה צאט ב jq ajax אני משתמש ב settimeout כדי לרענן את הפונקציה ששולפת בעזרת POST את הדף עם הצגת ההודעות.<br>עכשיו, אני יודע שזה לא יעיל מכוון שאם יש לי המון משתמשים בצאט, ואצל כל אחד הצאט מתרענן כל שנייה, זה יעמיס על השרת.<br>השאלה שלי איך אפשר לעשות שהצאט יתרענן אך ורק אם יש הודעה חדשה? כדי שיעמיס פחות על השרת?<br><br>תודה רבה! </div>
</div>
<h3>
<span id="answersCounter">11 </span>
תשובות
</h3>
<section class="answers" id="qnaAnswers">
<div class="answer" id="answer3990">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/a1dfe7b93101a49b740e428c78d9b829?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>yossi787</a>
ב
<span style="font-size:10px"> 20 לאוגוסט 2012 </span>
<a id="answer_3990" href="jquery ajax  יעילות צאט-1.htm#answer_3990">#</a>
</span>
<div class="clear"></div>
</div>
<p>
גם אם זה אפשרי, אני לא בטוח שזה יהיה יעיל כל-כך, בכל מקרה תצטרך לרענן את פונקציית הבדיקה... </p>
</div>
<div class="answer" id="answer3991">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 20 לאוגוסט 2012 </span>
<a id="answer_3991" href="jquery ajax  יעילות צאט-1.htm#answer_3991">#</a>
</span>
<div class="clear"></div>
</div>
<p>
אפשר לבצע long polling. </p>
</div>
<div class="answer" id="answer3993">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>nirbe</a>
ב
<span style="font-size:10px"> 20 לאוגוסט 2012 </span>
<a id="answer_3993" href="jquery ajax  יעילות צאט-1.htm#answer_3993">#</a>
</span>
<div class="clear"></div>
</div>
<p>
iiddaannyy, אפשר הסבר מה זה?<br>ואיך אתרים גדולים של צאטים עושים את זה? הם מרעננים כל שנייה? לא נראה לי. </p>
</div>
<div class="answer" id="answer3995">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 20 לאוגוסט 2012 </span>
<a id="answer_3995" href="jquery ajax  יעילות צאט-1.htm#answer_3995">#</a>
</span>
<div class="clear"></div>
</div>
<p>
long polling היא פשוט request ארוך לשרת. הדפדפן שולח לשרת בקשה -&gt; השרת בודק האם יש משהו חדש במסד.<br>כל עוד אין משהו חדש במסד הוא לא מחזיר תשובה.<br>ברגע שיש משהו חדש במסד הוא מחזיר תשובה לדפדפן וככה הדפדפן יודע שהתקבלה הודעה חדשה לדוגמה.<br><br>לחלופין, אפשר לעבוד עם node.js בצורה הזו (אני מאוד חדש בקטע של node.js, ככה שיכול להיות שאני מדבר שטויות עכשיו):<br><div class="php codeblock"><span class="kw2">var</span> net <span class="sy0">=</span> <span class="kw1">require</span><span class="br0">&#40;</span><span class="st_h">'net'</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
<span class="kw2">var</span> sockets <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="sy0">;</span><br>
<span class="kw2">var</span> chat <span class="sy0">=</span> net<span class="sy0">.</span>Server<span class="br0">&#40;</span><span class="kw2">function</span><span class="br0">&#40;</span>socket<span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; sockets<span class="sy0">.</span>push<span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">;</span><br>
&nbsp; &nbsp; socket<span class="sy0">.</span>on<span class="br0">&#40;</span><span class="st_h">'data'</span><span class="sy0">,</span> <span class="kw2">function</span><span class="br0">&#40;</span>data<span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw2">var</span> i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> sockets<span class="sy0">.</span>length<span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>sockets<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">!=</span> socket<span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sockets<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy0">.</span>write<span class="br0">&#40;</span>data<span class="br0">&#41;</span><span class="sy0">;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
&nbsp; &nbsp; socket<span class="sy0">.</span>on<span class="br0">&#40;</span><span class="st_h">'end'</span><span class="sy0">,</span> <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; sockets<span class="sy0">.</span>splice<span class="br0">&#40;</span>sockets<span class="sy0">.</span>indexOf<span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
chat<span class="sy0">.</span>listen<span class="br0">&#40;</span><span class="st_h">'100'</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// 100 is your port</span></div> </p>
</div>
<div class="answer" id="answer4005">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>nirbe</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4005" href="jquery ajax  יעילות צאט-1.htm#answer_4005">#</a>
</span>
<div class="clear"></div>
</div>
<p>
נראה מאוד מסובך, אני כנראה אצתרך ללמוד את ה node הזה. </p>
</div>
<div class="answer" id="answer4008">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4008" href="jquery ajax  יעילות צאט-1.htm#answer_4008">#</a>
</span>
<div class="clear"></div>
</div>
<p>
הבאתי דוגמה עם node.<br>node זו לא האופציה היחידה. </p>
</div>
<div class="answer" id="answer4009">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/0880f4fbb418c84bdb4a81ff8166072f?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>CaTz</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4009" href="jquery ajax  יעילות צאט-1.htm#answer_4009">#</a>
</span>
<div class="clear"></div>
</div>
<p>
בעקרון אתה צריך להשתמש בWEBSOCKET של HTML5, מה שזה עושה, זה משאיר חיבור קבוע בינך לבין השרת<br>ואם לשרת יש משהו חדש לעדכן הוא זה ששולח לך ולא אתה מתשאל אותו...<br>אני יודע שהצ&#039;ט של פייסבוק עובד על זה...<br>אבל זו שיטה ממש חדשה ולא נתמכת בכל הדפדפנים... </p>
</div>
<div class="answer" id="answer4010">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4010" href="jquery ajax  יעילות צאט-1.htm#answer_4010">#</a>
</span>
<div class="clear"></div>
</div>
<p>
האמת היא שראיתי פתרון נחמד לזה. את כל העניין של פתיחת הסוקטים והכל מבצעים בשרת.<br>(מאזינים להתחברויותבפורט מסוים, ואז שולחים סוקט באמצעות php)<br><br>בעמוד ה-html יוצרים iframe שמקשר לקובץ שפתח את הסוקט. כשיש הודעה חדשה, הקובץ שפתח את הסוקט שולח פלט לדפדפן (הפלט יופיע ב-iframe), ואותו פלט יכלול הפעלה של פונקציה בעמוד ה-html שלנו.<br><br>משהו כזה:<br><div class="php codeblock"><span class="sy0">&lt;</span>script<span class="sy0">&gt;</span><br>
<span class="kw2">function</span> newMessage<span class="br0">&#40;</span>msg<span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; alert<span class="br0">&#40;</span><span class="st_h">'new message: '</span><span class="sy0">+</span>msg<span class="br0">&#41;</span><span class="sy0">;</span><br>
<span class="br0">&#125;</span><br>
<span class="kw2">&lt;/script&gt;</span><br>
<span class="sy0">&lt;</span>iframe src<span class="sy0">=</span><span class="st0">&quot;sockets.php&quot;</span><span class="sy0">&gt;&lt;/</span>iframe<span class="sy0">&gt;</span></div><br>כל פעם שיש הודעה חדשה, sockets.php ישלח פלט חדש (שיופיע ב-iframe). דוגמה לפלט:<br><div class="php codeblock"><span class="sy0">&lt;</span>script<span class="sy0">&gt;</span><br>
parent<span class="sy0">.</span>newMessage<span class="br0">&#40;</span><span class="re0">$msg</span><span class="br0">&#41;</span><span class="sy0">;</span><br>
<span class="kw2">&lt;/script&gt;</span></div><br>וכך תופעל הפונקציה newMessage כשתגיעה הודעה חדשה.<br><br>http://www.youtube.com/watch?v=69OXnmbAaLI </p>
</div>
<div class="answer" id="answer4011">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/be497f5081a81b6333d998c4e9519c5f?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>questioner</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4011" href="jquery ajax  יעילות צאט-1.htm#answer_4011">#</a>
</span>
<div class="clear"></div>
</div>
<p>
עידן, אני די בטוח שאם אתה עובד עם סוקטים אתה צריך לכתוב בעצמך כל פעם HEADERS לפרוטוקול HTTP, אם אתה רוצה שזה יתפקד דרך הAJAX.(דיברתי על הnode) </p>
</div>
<div class="answer" id="answer4017">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/29c688bfdc6cb0d2e6dea24ccdc7beb1?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>intval</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4017" href="jquery ajax  יעילות צאט-1.htm#answer_4017">#</a>
</span>
<div class="clear"></div>
</div>
<p>
<a href="..\q902\שילוב http pushlong pollingweb sockets עם PHP.htm">שאלה באותו נושא</a> </p>
</div>
<div class="answer" id="answer4048">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 21 לאוגוסט 2012 </span>
<a id="answer_4048" href="jquery ajax  יעילות צאט-1.htm#answer_4048">#</a>
</span>
<div class="clear"></div>
</div>
<p>
האמת היא שהחלטתי לקחת יוזמה ולנסות לבנות מן שרת סוקטים קטן (אין לי מושג בכל העניין של סוקטים, ככה שזה טוב להתחלה).<br>הנה שרת סוקטים (אם זה בסדר לקרוא לזה כך, לא יודע) שמאזין לפורט 100.<br><a href="http://pastebin.com/jBRbPvpB">http://pastebin.com/jBRbPvpB</a><br><br>תמונה של זה עובד (תמונה גדולה, מצטער):<br><a href="http://ufu.co.il/files/se3whjuwkuvlwi6nxthl.png">http://ufu.co.il/files/se3whjuwkuvlwi6nxthl.png</a><br><br>סדר הפעולות בתמונה:<br>1. מפעילים את השרת (את ההאזנה לפורט 100) על ידי הרצת הקובץ.<br>2. שלושה מתחברים לשרת.<br>3. קליינט ראשון בוחר את השם Idan.<br>4. קליינט שני את intval.<br>5. קליינט שלישי את questioner.<br>6. Idan שולח הודעה.<br>7. intval שולח הודעה.<br>8. questioner שולח הודעה.<br>9. Idan סוגר את החיבור שלו לשרת (ctrl+c עושה את זה בלינוקס. אם אני לא טועה אז גם במאק).<br>10. intval סוגר את החיבור.<br>11. questioner סוגר את החיבור.<br>12. סגירה של השרת. </p>
</div>
</section>
</section>  
<section id="sidebar">
<section id="search_box">
<form method="get" action="http://www.google.co.il/search" id="search_form">
<input type="hidden" name="hl" value="iw">
<input type="checkbox" name="sitesearch" style="display:none" value="https://phpguide.co.il" checked="">
<input type="text" class="search_form" placeholder="חיפוש" name="q" id="search_field">
<input type="submit" value="" title="לחפש">
</form>
</section>
<style>.staticSidebarPageLinks a{color:#e85a2d;font-weight:bold;text-decoration:underline}</style>
<div class='rblock staticSidebarPageLinks' style="padding:0 -50px; width:100%; background: white;">
<a href="page_mvcebook.html" title="למד איך עובד MVC" onclick="Analytics.track('Promotion', 'click', 'GoToLanding', 'mvcebook-sidebar-banner1');">
ספר חינם על MVC
</a>
שאתה הולך להוריד כי אם אתה רוצה ללמוד על ארגון קוד יעיל ומודרני באתרים כמו זה או פייסבוק או כי כולם אוהבים להוריד דברים איכותיים בחינם מהאינטרנט
<br><br>
<a href='page_oopbook.html'>
ספר הלימוד - תכנות מונחה עצמים מאפס
</a>
שסוף סוף ילמד אותך פיתוח מונחה עצמים נכון בצורה פשוטה, יענה על כל השאלות ויכין אותך לרעיונות עבודה.
<br><br>
<a href='page_phpunit.html'>
קורס בדיקות יחידה phpunit
</a>
שיעזור לך להקטין בחצי את כמות הבאגים, את כאב הראש והזמן המבוזבז על פתירתם
<br><br>
<a href='page_mysqlinteractive.html'>
קורס mysql אינטרקטיבי
</a>
שיייקח אותך צעד אחר צעד למומחה שאילתות mysql לייב
<br><br><br>
<small>האתר ב-readonly
<br>
תודה לכל מי שתרם, ענה, שאל, כתב, לימד ועזר במשך השנים <br>
orelbey, splash, raslin, cayce, iiddaannyy, michael, kingyes, ilikeme, itamarhadad, iosolidar, jbstyle<br>
- alex@הדומיין הזה
</small>
</div>
</section>
</div>
<footer id='footer'>
</footer>
</div>  
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular-resource.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular-cookies.min.js"></script>
<script type="text/javascript" src="..\assets\c2224fc8\jquery.min.js"></script>
<script type="text/javascript" src="..\static\scripts\scripts.compiled.js"></script>
<script type="text/javascript" src="..\static\scripts\plugins.js"></script>
<script type="text/javascript" src="..\static\scripts\ui.js"></script>
<script type="text/javascript" src="..\static\scripts\analytics.js"></script>
</body>
</html>
