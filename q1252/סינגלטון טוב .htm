<!DOCTYPE html>
<html lang="he" itemscope="" itemtype="http://schema.org/Blog" ng-app="phpg">
<head>
<base href="http://phpguide.co.il/">
<meta charset="utf-8">
<meta name="description" content="שאלה סינגלטון טוב ?">
<meta name="keywords" content="שאלה, עזרה">
<meta name="author" content="משהה">
<link rel="shortcut icon" href="..\static\images\favicon.ico">
<!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="..\static\styles\A.allstyles.compiled.css.pagespeed.cf.P4R8BwzxFu.css">
<title>סינגלטון טוב ? | שאלת לימוד PHP</title>
<meta itemprop="name" content="סינגלטון טוב ? | שאלת לימוד PHP">
<meta itemprop="description" content="שאלה סינגלטון טוב ?">
</head>
<body dir='rtl' class="forum-qna">
<div class='page-container'>
<section id='header'>
<div class="topRowHolder">
<a class="logo" href="..\index.htm"><img src="..\static\images\xlogo.jpg.pagespeed.ic.6YgiLES4FJ.jpg"></a>
<nav class="main">
<ul>
<li><a href="..\index.htm">פוסטים</a></li>
<li><a href="..\qna.htm" class="active">פורום</a></li>
</ul>
<div class="clear"></div>
</nav> <div class="clear"></div>
</div>
</section>  
<div class="layout-holder">
<section id="content">
<div class="qna_view_question" id="qnaQuestionHolder">
<div class="qna-home-row">
<div class="counts">
 
<div class="status  answered">
<div class="item-count">6</div>
<div>
תגובות
</div>
</div>
</div>
<div class="question-summary-wrapper">
<h2><a href="סינגלטון טוב .htm" title="אז אחרי שקראתי על סינגלטון , לקחתי על עצמי לעשות סינגלטון עם הקונסטרקט ולאו דווקא עם פונקציה סטטית אחרת. ניסיתי לחשוב על אפשרות למשתנה מחוץ לקלאס, ואז להשתמש בGLOBALS אבל חשבתי שאולי יש דרך אחרת, אז ניסיתי את זאת. אחרי שהסתכלתי שוב, שמתי לב שכול פעם שמגדירים את הקלאס המאפיין instance  הופך ישירות לNULL ואז אין כל טעם כי הבדיקה תמיד תראה שהוא ריק (כי תכלס זה נכון, הוא הוגדר מחדש כריק) אז הבנתי שעשיתי פה משו דפוק .. יש לכם הצעות או משו לגבי איך לשנות אתזה, שinstance  לא יוגדר בכול מופע חדש של הקלא">סינגלטון טוב ?</a></h2>
<div class="userinfo">
פתח
<a>משהה</a>
,
<time class="timeago relativetime" datetime="2013-02-17T19:44:32+02:00" style="display:inline-block;">
17 לפברואר 2013 </time>
</div>
</div>
</div> <div class="clear"></div>
<div style="border-top:1px dashed #D1D1D1; margin-top:10px; padding-top:10px; " class="qnapost" id='questionText1252'>
אז אחרי שקראתי על סינגלטון , לקחתי על עצמי לעשות סינגלטון עם הקונסטרקט ולאו דווקא עם פונקציה סטטית אחרת. ניסיתי לחשוב על אפשרות למשתנה מחוץ לקלאס, ואז להשתמש בGLOBALS אבל חשבתי שאולי יש דרך אחרת, אז ניסיתי את זאת. אחרי שהסתכלתי שוב, שמתי לב שכול פעם שמגדירים את הקלאס המאפיין instance הופך ישירות לNULL ואז אין כל טעם כי הבדיקה תמיד תראה שהוא ריק (כי תכלס זה נכון, הוא הוגדר מחדש כריק) אז הבנתי שעשיתי פה משו דפוק .. יש לכם הצעות או משו לגבי איך לשנות אתזה, שinstance לא יוגדר בכול מופע חדש של הקלאס? או שאין אפשרות כזאת והאפשרות היחידה היא להשתמש בGLOBALS ? <br><br><br><div class="php codeblock"><span class="kw2">class</span> db <span class="kw2">extends</span> PDO <span class="br0">&#123;</span><br>
<br>
<span class="kw2">private</span> static <span class="re0">$instance</span> <span class="sy0">=</span> <span class="kw4">null</span><span class="sy0">;</span><br>
&nbsp; &nbsp; <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span><span class="re0">$dsn</span><span class="sy0">,</span> <span class="re0">$username</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$driver_options</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">self</span><span class="sy0">::</span><span class="re0">$instance</span> <span class="sy0">===</span> <span class="kw4">null</span> <span class="br0">&#41;</span> <span class="co1">// check instance ;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="re0">$options</span> <span class="sy0">=</span> <span class="kw3">array_merge</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">bulidin_options</span><span class="sy0">,</span><span class="re0">$driver_options</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// mix the arrays;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw2">self</span><span class="sy0">::</span><span class="re0">$instance</span> <span class="sy0">=</span> parent<span class="sy0">::</span>__construct<span class="br0">&#40;</span><span class="re0">$dsn</span><span class="sy0">,</span> <span class="re0">$username</span><span class="sy0">,</span> <span class="re0">$password</span><span class="sy0">,</span> <span class="re0">$options</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// define $instance;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">connected</span> <span class="sy0">=</span> <span class="kw4">true</span><span class="sy0">;</span> <span class="co1">// define $connected;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw2">self</span><span class="sy0">::</span><span class="re0">$instance</span><span class="sy0">;</span> <span class="co1">// return the instance;</span><br>
&nbsp; &nbsp; <span class="br0">&#125;</span><br>
<br>
<span class="br0">&#125;</span></div><br><br>אל תתייחסו לכל הקוד , אני הראיתי רק את הקטעים שעוסקים בסינגלטון. </div>
</div>
<h3>
<span id="answersCounter">6 </span>
תשובות
</h3>
<section class="answers" id="qnaAnswers">
<div class="answer" id="answer5492">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/7879b706e45bf4406cf3f246538d767f?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>OrelBeY</a>
ב
<span style="font-size:10px"> 18 לפברואר 2013 </span>
<a id="answer_5492" href="סינגלטון טוב .htm#answer_5492">#</a>
</span>
<div class="clear"></div>
</div>
<p>
אני בטוח שחשבו על זה. מסתבר שהפתרון הכי טוב הוא בדרך שקראת עליה. :) </p>
</div>
<div class="answer" id="answer5494">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/29c688bfdc6cb0d2e6dea24ccdc7beb1?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>intval</a>
ב
<span style="font-size:10px"> 18 לפברואר 2013 </span>
<a id="answer_5494" href="סינגלטון טוב .htm#answer_5494">#</a>
</span>
<div class="clear"></div>
</div>
<p>
הבעיה היא שב-PHP אי אפשר להחזיר משהו בקונדסטרקטור:<br><div class="php codeblock"><span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span><span class="kw1">return</span> <span class="nu0">7</span><span class="sy0">;</span><span class="br0">&#125;</span></div><br>PHP תמיד תיצוא מופע חדש ותחזיר אותו, לא משנה איזה קוד תוסיף אתה בנוסף לתהליך הזה בתוך הפונקציה construct </p>
</div>
<div class="answer" id="answer5495">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 18 לפברואר 2013 </span>
<a id="answer_5495" href="סינגלטון טוב .htm#answer_5495">#</a>
</span>
<div class="clear"></div>
</div>
<p>
זה בלתי אפשרי לעשות ככה.<br>constructors לא מחזירים ערך. וגם אם תעשה return אז זה פשוט יפסיק את פעולת ה-constructor אבל הערך שתחזיר יהיה חסר כל משמעות.<br>בנוגע למשתנה static, זו לא בעיה לתקן את זה. הדבר הכי קרוב שאתה יכול לעשות הוא זה:<br>http://phpguide.co.il/phplive?code=667<br><br>במקרה הזה, אין לך פעולה סטטית שמחזירה את האובייקט היחידי של המחלקה. לכן כדי להשתמש באותו אובייקט תהיה תמיד חייב להיות בעל גישה אל ההפנייה אל אותו אובייקט (המשתנה ש&quot;מחזיק&quot; את האובייקט).<br><br>ככה שהבעיה בקוד שלך היא לא המשתנה instance, ובטח שאתה לא צריך להשתמש ב-globals. הבעיה היא שהערכים שה-constructor מחזיר הם חסרי ערך ואף אחד לא מתייחס אליהם. </p>
</div>
<div class="answer" id="answer5497">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/5d7b8036b4428cc7b9e0d03afd1807e1?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>משהה</a>
ב
<span style="font-size:10px"> 19 לפברואר 2013 </span>
<a id="answer_5497" href="סינגלטון טוב .htm#answer_5497">#</a>
</span>
<div class="clear"></div>
</div>
<p>
תודה רבה לכם :)<br>לא הבנתי בקוד שלך את השורה הזאת : <br><div class="php codeblock"><span class="br0">&#40;</span><span class="kw2">self</span><span class="sy0">::</span><span class="re0">$instance</span> instanceof <span class="re0">$this</span><span class="br0">&#41;</span></div><br><br>וסיימתי את המחלקה שלי(אם אפשר לקרוא לזה מחלקה חח הכנסתי בתוכה את הדברים הבסיסיים ביותר..): http://pastebin.com/46jJ7C9D אשמח אם תוכלו לתת לי ביקורת ומה צריך לתקן .. :)<br><br>זה הקוד המתוקן : <br>http://pastebin.com/8M3c8Bq5 </p>
</div>
<div class="answer" id="answer5498">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=20&amp;r=g&amp;d=mm" alt="avatar"> ענה
<a>iiddaannyy</a>
ב
<span style="font-size:10px"> 19 לפברואר 2013 </span>
<a id="answer_5498" href="סינגלטון טוב .htm#answer_5498">#</a>
</span>
<div class="clear"></div>
</div>
<p>
* ה-constructor שלך חייב להיות private כדי שלא יוכלו ליצור עצמים מהמחלקה שלך מבחוץ.<br><br>(self::$instance instanceof $this)<br>בודק האם המשתנה instance הוא עצם מהסוג של המחלקה הנוכחית.<br>בחפש בגוגל instanceof php (לא חייב php זה בכל השפות בעל אותה המשמעות). </p>
</div>
<div class="answer" id="answer5501">
<div>
<span class="userinfo">
<img class="avatar" src="http://www.gravatar.com/avatar/5d7b8036b4428cc7b9e0d03afd1807e1?s=20&amp;r=g&amp;d=monsterid" alt="avatar"> ענה
<a>משהה</a>
ב
<span style="font-size:10px"> 21 לפברואר 2013 </span>
<a id="answer_5501" href="סינגלטון טוב .htm#answer_5501">#</a>
</span>
<div class="clear"></div>
</div>
<p>
PDO לא מרשה קונסטרקטור מסוג private.. זה נותן לי שגיאה כזאתי...<br>אהה נחמד לדעת עלזה :) בחיים לא שמעתי על האופרטור הזה..תודה :) </p>
</div>
</section>
</section>  
<section id="sidebar">
<section id="search_box">
<form method="get" action="http://www.google.co.il/search" id="search_form">
<input type="hidden" name="hl" value="iw">
<input type="checkbox" name="sitesearch" style="display:none" value="http://phpguide.co.il" checked="">
<input type="text" class="search_form" placeholder="חיפוש" name="q" id="search_field">
<input type="submit" value="" title="לחפש">
</form>
</section>
<style>.staticSidebarPageLinks a{color:#e85a2d;font-weight:bold;text-decoration:underline}</style>
<div class='rblock staticSidebarPageLinks' style="padding:0 -50px; width:100%; background: white;">
<a href="page_mvcebook.html" title="למד איך עובד MVC" onclick="Analytics.track('Promotion', 'click', 'GoToLanding', 'mvcebook-sidebar-banner1');">
ספר חינם על MVC
</a>
שאתה הולך להוריד כי אם אתה רוצה ללמוד על ארגון קוד יעיל ומודרני באתרים כמו זה או פייסבוק או כי כולם אוהבים להוריד דברים איכותיים בחינם מהאינטרנט
<br><br>
<a href='page_oopbook.html'>
ספר הלימוד - תכנות מונחה עצמים מאפס
</a>
שסוף סוף ילמד אותך פיתוח מונחה עצמים נכון בצורה פשוטה, יענה על כל השאלות ויכין אותך לרעיונות עבודה.
<br><br>
<a href='page_phpunit.html'>
קורס בדיקות יחידה phpunit
</a>
שיעזור לך להקטין בחצי את כמות הבאגים, את כאב הראש והזמן המבוזבז על פתירתם
<br><br>
<a href='page_mysqlinteractive.html'>
קורס mysql אינטרקטיבי
</a>
שיייקח אותך צעד אחר צעד למומחה שאילתות mysql לייב
<br><br><br>
<small>האתר ב-readonly
<br>
תודה לכל מי שתרם, ענה, שאל, כתב, לימד ועזר במשך השנים <br>
orelbey, splash, raslin, cayce, iiddaannyy, michael, kingyes, ilikeme, itamarhadad, iosolidar, jbstyle<br>
- alex@הדומיין הזה
</small>
</div>
</section>
</div>
<footer id='footer'>
</footer>
</div>  
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular-resource.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular-cookies.min.js"></script>
<script type="text/javascript" src="..\assets\c2224fc8\jquery.min.js.pagespeed.jm.0IhQ85x_cu.js"></script>
<script src="..\static\scripts\scripts.compiled.js plugins.js ui.js analytics.js.pagespeed.jc.HoDAx8MSoV.js"></script><script>eval(mod_pagespeed_suqc1br1Uj);</script>
<script>eval(mod_pagespeed_tNeKvp6lmR);</script>
<script>eval(mod_pagespeed_PxPJYmoXjB);</script>
<script>eval(mod_pagespeed_2G0hMgPcln);</script>
</body>
</html>
